<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MiCAR EMT License Tracker - Electronic Money Token Issuers</title>
    <!-- Open Graph metadata -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://micatracker.digital-euro-association.de/">
    <meta property="og:title" content="MiCAR EMT License Tracker - Electronic Money Token Issuers">
    <meta property="og:description" content="Track Electronic Money Token issuers and MiCAR EMT licenses across Europe.">
    <meta property="og:image" content="https://micatracker.digital-euro-association.de/cover.png">

    <!-- Twitter Card metadata -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://micatracker.digital-euro-association.de/">
    <meta name="twitter:title" content="MiCAR EMT License Tracker - Electronic Money Token Issuers">
    <meta name="twitter:description" content="Track Electronic Money Token issuers and MiCAR EMT licenses across Europe.">
    <meta name="twitter:image" content="https://micatracker.digital-euro-association.de/cover.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

    body {
    font-family: 'Inter', sans-serif;
    background: linear-gradient(90deg, #58c1ba, #004aad);
    min-height: 100vh;
    }

    .main-bg {
    background: linear-gradient(90deg, #58c1ba, #004aad);
    }

    .header-sticky {
    position: sticky;
    top: 0;
    z-index: 50;
    backdrop-filter: blur(10px);
    background: linear-gradient(90deg, rgba(88, 193, 186, 0.95), rgba(0, 74, 173, 0.95));
    }

    .card-hover {
    transition: all 0.3s ease;
    }

    .card-hover:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    .progress-bar {
    transition: width 0.8s ease-in-out;
    }

    .fade-in {
    animation: fadeIn 0.6s ease-in;
    }

    @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
    }

    .kpi-card {
    background: linear-gradient(135deg, var(--start-color), var(--end-color));
    }

    /* Complementary colors to the teal-blue gradient */
    .kpi-teal { --start-color: #14b8a6; --end-color: #0f766e; }
    .kpi-blue { --start-color: #0ea5e9; --end-color: #0369a1; }
    .kpi-orange { --start-color: #f97316; --end-color: #ea580c; }
    .kpi-coral { --start-color: #f43f5e; --end-color: #e11d48; }
    .kpi-purple { --start-color: #8b5cf6; --end-color: #7c3aed; }
    .kpi-red { --start-color: #dc2626; --end-color: #b91c1c; }
    .kpi-green { --start-color: #10b981; --end-color: #059669; }
    .kpi-yellow { --start-color: #f59e0b; --end-color: #d97706; }

    .search-input {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    }

    .content-bg {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    }

    .logo-container {
    max-height: 80px;
    width: auto;
    margin-right: 20px;
    }

    .tab-button {
    transition: all 0.3s ease;
    }

    .tab-active {
    background: white;
    color: #1e40af;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .tab-inactive {
    background: rgba(59, 130, 246, 0.3);
    color: white;
    }

    .tab-inactive:hover {
    background: rgba(59, 130, 246, 0.5);
    }

    /* Dynamic currency cards */
    .currency-card {
    transition: all 0.3s ease;
    }

    .currency-card:hover {
    transform: scale(1.05);
    }

    /* === Sticky header shrink on scroll === */
    .header-sticky {
        transition: all 0.3s ease-in-out;
    }

    .header-sticky.shrink {
        padding-top: 0.5rem;   /* smaller vertical padding */
        padding-bottom: 0.5rem;
    }

    .header-sticky.shrink .logo-container {
        max-height: 40px;      /* shrink logo */
    }

    .header-sticky.shrink h1 {
        font-size: 1.5rem;     /* Tailwind 'text-2xl' */
    }

    .header-sticky.shrink .additional-info {
        display: none;         /* hide extra header lines */
    }

    .header-sticky.shrink .tab-button {
        padding: 0.5rem 1rem;  /* tighter buttons */
        font-size: 0.875rem;   /* Tailwind 'text-sm' */
    }
    </style>
    <style>
    /* hide the "xx.x% of total" under each card */
    #eurPercentage,
    #usdPercentage,
    #gbpPercentage,
    #czkPercentage {
    display: none;
    }
    </style>

    <style>
  /* hide the entire "Currency Distribution Analysis" card */
  .card-hover:has(.fa-coins) {
    display: none !important;
  }
</style>
</head>
<body class="main-bg">
    <!-- Sticky Header -->
    <div class="header-sticky shadow-2xl">
    <div class="max-w-7xl mx-auto px-6 py-6">
    <div class="flex items-center justify-between flex-wrap">
    <div class="flex items-start space-x-6 mb-4 md:mb-0">
    <img src="https://cdn.abacus.ai/images/5bf38e3c-f4e1-4450-8d41-277ada1b7069.png" 
    alt="DEA Logo" class="logo-container">
    <div>
    <h1 class="text-4xl font-bold text-white mb-1">MiCAR EMT License Tracker</h1>
    <p class="text-blue-100 text-lg additional-info">Electronic Money Token Issuers Analytics</p>
    <p class="text-blue-200 text-sm mt-1 additional-info">Source: ESMA EMT Register, Invalid Date</p>
    </div>
    </div>
    <div class="flex space-x-3">
    <button id="overviewBtn" class="tab-button tab-active px-5 py-3 rounded-xl font-semibold">
    <i class="fas fa-chart-pie mr-2"></i>Overview
    </button>
    <button id="detailsBtn" class="tab-button tab-inactive px-5 py-3 rounded-xl font-semibold">
    <i class="fas fa-table mr-2"></i>Details
    </button>
    <button id="nonCompliantBtn" class="tab-button tab-inactive px-5 py-3 rounded-xl font-semibold">
    <i class="fas fa-exclamation-triangle mr-2"></i>Non-Compliant
    </button>
    </div>
    </div>
    </div>
    </div>

    <div class="max-w-7xl mx-auto px-6 py-8">
    <!-- KPI Cards Container - Dynamic -->
    <div id="kpiContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-6 mb-8 fade-in">
    <!-- Will be populated dynamically by JavaScript -->
    </div>

    <!-- Overview Section -->
    <div id="overviewSection" class="fade-in">
    <!-- Charts Row -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
    <div class="bg-white bg-opacity-95 backdrop-filter backdrop-blur-lg rounded-2xl shadow-lg p-6 card-hover">
    <h3 class="text-xl font-bold text-gray-800 mb-4">
    <i class="fas fa-globe-europe text-teal-600 mr-2"></i>Geographic Distribution
    </h3>
    <div class="space-y-4" id="countryChart">
    <!-- Will be populated by JavaScript -->
    </div>
    </div>

    <div class="bg-white bg-opacity-95 backdrop-filter backdrop-blur-lg rounded-2xl shadow-lg p-6 card-hover">
    <h3 class="text-xl font-bold text-gray-800 mb-4">
    <i class="fas fa-university text-blue-600 mr-2"></i>Regulatory Authorities
    </h3>
    <div class="space-y-4" id="authorityChart">
    <!-- Will be populated by JavaScript -->
    </div>
    </div>
    </div>

    <!-- Currency Distribution -->
    <div class="bg-white bg-opacity-95 backdrop-filter backdrop-blur-lg rounded-2xl shadow-lg p-6 card-hover">
    <h3 class="text-xl font-bold text-gray-800 mb-4">
    <i class="fas fa-coins text-orange-600 mr-2"></i>Currency Distribution Analysis
    </h3>
    <div id="currencyDistribution" class="grid grid-cols-1 md:grid-cols-4 gap-6">
    <!-- Will be populated dynamically by JavaScript -->
    </div>
    </div>
    </div>

    <!-- Details Section -->
    <div id="detailsSection" class="hidden fade-in">
    <div class="bg-white bg-opacity-95 backdrop-filter backdrop-blur-lg rounded-2xl shadow-lg p-6 card-hover">
    <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
    <h3 class="text-xl font-bold text-gray-800 mb-4 md:mb-0">
    <i class="fas fa-list-alt text-teal-600 mr-2"></i>Detailed Issuer Information
    </h3>
    <div class="flex items-center space-x-4">
    <div class="relative">
    <input type="text" id="searchInput" placeholder="Search issuers, countries, tokens..." 
    class="search-input pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-teal-500 focus:border-transparent w-64">
    <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
    </div>
    <button id="clearSearch" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
    <i class="fas fa-times mr-1"></i>Clear
    </button>
    </div>
    </div>
    <div class="overflow-x-auto">
    <table class="w-full">
    <thead>
    <tr class="bg-gradient-to-r from-teal-50 to-blue-50">
    <th class="text-left p-4 font-semibold text-gray-700">Issuer</th>
    <th class="text-left p-4 font-semibold text-gray-700">Country</th>
    <th class="text-left p-4 font-semibold text-gray-700">Authority</th>
    <th class="text-left p-4 font-semibold text-gray-700">Tokens</th>
    <th class="text-center p-4 font-semibold text-gray-700">Count</th>
    <th class="text-center p-4 font-semibold text-gray-700">Currencies</th>
    </tr>
    </thead>
    <tbody id="detailsTable">
    <!-- Will be populated by JavaScript -->
    </tbody>
    </table>
    </div>
    <div id="noResults" class="hidden text-center py-8 text-gray-500">
    <i class="fas fa-search text-4xl mb-4"></i>
    <p class="text-lg">No results found for your search.</p>
    </div>
    </div>
    </div>

    <!-- Non-Compliant Section -->
    <div id="nonCompliantSection" class="hidden fade-in">
    <div class="bg-white bg-opacity-95 backdrop-filter backdrop-blur-lg rounded-2xl shadow-lg p-6 card-hover">
    <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
    <h3 class="text-xl font-bold text-gray-800 mb-4 md:mb-0">
    <i class="fas fa-exclamation-triangle text-red-600 mr-2"></i>Non-Compliant Entities
    </h3>
    <div class="flex items-center space-x-4">
    <div class="relative">
    <input type="text" id="nonCompliantSearchInput" placeholder="Search entities, authorities, websites..." 
    class="search-input pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-red-500 focus:border-transparent w-64">
    <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
    </div>
    <button id="clearNonCompliantSearch" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
    <i class="fas fa-times mr-1"></i>Clear
    </button>
    </div>
    </div>

    <div class="overflow-x-auto">
    <table class="w-full">
    <thead>
    <tr class="bg-gradient-to-r from-red-50 to-orange-50">
    <th class="text-left p-4 font-semibold text-gray-700">Entity Name</th>
    <th class="text-left p-4 font-semibold text-gray-700">Country</th>
    <th class="text-left p-4 font-semibold text-gray-700">Regulatory Authority</th>
    <th class="text-left p-4 font-semibold text-gray-700">Websites</th>
    <th class="text-center p-4 font-semibold text-gray-700">Status</th>
    </tr>
    </thead>
    <tbody id="nonCompliantTable">
    <!-- Will be populated by JavaScript -->
    </tbody>
    </table>
    </div>
    <div id="noNonCompliantResults" class="hidden text-center py-8 text-gray-500">
    <i class="fas fa-search text-4xl mb-4"></i>
    <p class="text-lg">No results found for your search.</p>
    </div>
    </div>
    </div>
    </div>

    <!-- ==== DEA FOOTER START ==== -->
    <footer class="bg-gray-900 text-gray-200 mt-12">
      <div class="max-w-7xl mx-auto px-4 py-10 space-y-10">

        <!-- ── Headline & snapshot date ── -->
        <div class="text-center">
          <p class="text-gray-300">
            MiCAR EMT License Tracker – Electronic Money Token Regulatory Overview
          </p>
          <p class="text-gray-400 text-sm mt-2" id="currentDate">
            Data as of Invalid Date
          </p>
        </div>

        <!-- ── Nav links + social icons ── -->
        <div class="flex flex-col md:flex-row md:justify-between gap-8">
          <!-- Nav -->
          <nav>
            <ul class="space-y-2 md:space-y-0 md:flex md:gap-6 text-sm">
              <li><a href="https://home.digital-euro-association.de/legal-notice?hsLang=en"  target="_blank" rel="noopener" class="hover:text-white font-semibold">Legal Notice</a></li>
              <li><a href="https://home.digital-euro-association.de/privacy-policy-0?hsLang=en" target="_blank" rel="noopener" class="hover:text-white font-semibold">Privacy</a></li>
              <li><a href="https://home.digital-euro-association.de/code-of-conduct?hsLang=en"  target="_blank" rel="noopener" class="hover:text-white font-semibold">Code of Conduct</a></li>
              <li><a href="https://home.digital-euro-association.de/faq?hsLang=en"            target="_blank" rel="noopener" class="hover:text-white font-semibold">FAQ</a></li>
              <li><a href="https://home.digital-euro-association.de/impressum?hsLang=en"      target="_blank" rel="noopener" class="hover:text-white font-semibold">Impressum</a></li>
            </ul>
          </nav>

          <!-- Social -->
          <div class="flex items-center gap-6 text-xl">
            <a href="https://twitter.com/DigiEuro" target="_blank" aria-label="Twitter"  class="hover:text-white"><i class="fab fa-twitter"></i></a>
            <a href="mailto:info@digital-euro-association.de" target="_blank" aria-label="Email" class="hover:text-white"><i class="fas fa-envelope"></i></a>
            <a href="https://www.linkedin.com/company/digital-euro-association/" target="_blank" aria-label="LinkedIn" class="hover:text-white"><i class="fab fa-linkedin"></i></a>
          </div>
        </div>

        <!-- ── Bottom row: copyright + CTA ── -->
        <div class="border-t border-gray-700 pt-6 flex flex-col md:flex-row md:justify-between md:items-center gap-4">
          <p class="text-xs">&copy; <span id="year"></span> Digital Euro Association e.V.</p>

          <a href="https://digital-euro-association.de"
             class="inline-block bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold px-5 py-2 rounded-lg shadow transition">
            Learn more about DEA
          </a>
        </div>
      </div>
    </footer>
    <!-- ==== DEA FOOTER END ==== -->

    <script>
    // Comprehensive European country flags mapping
    const countryFlags = {
        // Current EU Member States
        'Austria': '🇦🇹',
        'Belgium': '🇧🇪',
        'Bulgaria': '🇧🇬',
        'Croatia': '🇭🇷',
        'Cyprus': '🇨🇾',
        'Czech Republic': '🇨🇿',
        'Denmark': '🇩🇰',
        'Estonia': '🇪🇪',
        'Finland': '🇫🇮',
        'France': '🇫🇷',
        'Germany': '🇩🇪',
        'Greece': '🇬🇷',
        'Hungary': '🇭🇺',
        'Ireland': '🇮🇪',
        'Italy': '🇮🇹',
        'Latvia': '🇱🇻',
        'Lithuania': '🇱🇹',
        'Luxembourg': '🇱🇺',
        'Malta': '🇲🇹',
        'Netherlands': '🇳🇱',
        'Poland': '🇵🇱',
        'Portugal': '🇵🇹',
        'Romania': '🇷🇴',
        'Slovakia': '🇸🇰',
        'Slovenia': '🇸🇮',
        'Spain': '🇪🇸',
        'Sweden': '🇸🇪',

        // EEA Countries (non-EU)
        'Iceland': '🇮🇸',
        'Liechtenstein': '🇱🇮',
        'Norway': '🇳🇴',

        // Other European Countries
        'Albania': '🇦🇱',
        'Andorra': '🇦🇩',
        'Armenia': '🇦🇲',
        'Azerbaijan': '🇦🇿',
        'Belarus': '🇧🇾',
        'Bosnia and Herzegovina': '🇧🇦',
        'Georgia': '🇬🇪',
        'Kazakhstan': '🇰🇿',
        'Kosovo': '🇽🇰',
        'Moldova': '🇲🇩',
        'Monaco': '🇲🇨',
        'Montenegro': '🇲🇪',
        'North Macedonia': '🇲🇰',
        'Russia': '🇷🇺',
        'San Marino': '🇸🇲',
        'Serbia': '🇷🇸',
        'Switzerland': '🇨🇭',
        'Turkey': '🇹🇷',
        'Ukraine': '🇺🇦',
        'United Kingdom': '🇬🇧',
        'Vatican City': '🇻🇦',

        // Common alternative names
        'UK': '🇬🇧',
        'Britain': '🇬🇧',
        'Great Britain': '🇬🇧',
        'England': '🏴󠁧󠁢󠁥󠁮󠁧󠁿',
        'Scotland': '🏴󠁧󠁢󠁳󠁣󠁴󠁿',
        'Wales': '🏴󠁧󠁢󠁷󠁬󠁳󠁿',
        'Northern Ireland': '🇬🇧'
    };

    // Currency symbols and information
    const currencyInfo = {
        'EUR': { symbol: '💶', name: 'Euro', color: 'orange' },
        'USD': { symbol: '💵', name: 'US Dollar', color: 'coral' },
        'GBP': { symbol: '💷', name: 'British Pound', color: 'purple' },
        'CZK': { symbol: '🇨🇿', name: 'Czech Koruna', color: 'blue' },
        'HKD': { symbol: '🇭🇰', name: 'Hong Kong Dollar', color: 'green' },
        'CHF': { symbol: '🇨🇭', name: 'Swiss Franc', color: 'red' },
        'SEK': { symbol: '🇸🇪', name: 'Swedish Krona', color: 'yellow' },
        'NOK': { symbol: '🇳🇴', name: 'Norwegian Krone', color: 'teal' },
        'DKK': { symbol: '🇩🇰', name: 'Danish Krone', color: 'blue' },
        'PLN': { symbol: '🇵🇱', name: 'Polish Zloty', color: 'red' },
        'HUF': { symbol: '🇭🇺', name: 'Hungarian Forint', color: 'green' },
        'RON': { symbol: '🇷🇴', name: 'Romanian Leu', color: 'yellow' }
    };

    // KPI card color classes
    const kpiColors = ['kpi-teal', 'kpi-blue', 'kpi-orange', 'kpi-coral', 'kpi-purple', 'kpi-red', 'kpi-green', 'kpi-yellow'];

    // Data - will be updated by the automation script
    const snapshotDate = 'undefined';
    const data = [
    {
        "id": 1,
        "issuer": "Circle Internet Financial EU SAS",
        "state": "France",
        "authority": "ACPR",
        "tokens": "EURC, USDC",
        "count": 2,
        "euro": 1,
        "usd": 1,
        "czk": 0,
        "gbp": 0
    },
    {
        "id": 2,
        "issuer": "Société Générale – Forge",
        "state": "France",
        "authority": "ACPR",
        "tokens": "EURCV",
        "count": 1,
        "euro": 1,
        "usd": 0,
        "czk": 0,
        "gbp": 0
    },
    {
        "id": 3,
        "issuer": "Schuman Financial SAS",
        "state": "France",
        "authority": "ACPR",
        "tokens": "EURØP",
        "count": 1,
        "euro": 1,
        "usd": 0,
        "czk": 0,
        "gbp": 0
    },
    {
        "id": 4,
        "issuer": "Paxos",
        "state": "Finland",
        "authority": "FIN-FSA",
        "tokens": "EUROe, eUSD, USDG",
        "count": 3,
        "euro": 1,
        "usd": 2,
        "czk": 0,
        "gbp": 0
    },
    {
        "id": 5,
        "issuer": "Eurodollar ApS",
        "state": "Denmark",
        "authority": "Finanstilsynet",
        "tokens": "USDE",
        "count": 1,
        "euro": 0,
        "usd": 1,
        "czk": 0,
        "gbp": 0
    },
    {
        "id": 6,
        "issuer": "Banking Circle S.A.",
        "state": "Luxembourg",
        "authority": "CSSF",
        "tokens": "EURI",
        "count": 1,
        "euro": 1,
        "usd": 0,
        "czk": 0,
        "gbp": 0
    },
    {
        "id": 7,
        "issuer": "Quantoz Payments B.V.",
        "state": "Netherlands",
        "authority": "Dutch National Bank",
        "tokens": "EURQ, USDQ, EURD",
        "count": 3,
        "euro": 2,
        "usd": 1,
        "czk": 0,
        "gbp": 0
    },
    {
        "id": 8,
        "issuer": "StablR Ltd",
        "state": "Malta",
        "authority": "MFSA",
        "tokens": "USDR, EURR",
        "count": 2,
        "euro": 1,
        "usd": 1,
        "czk": 0,
        "gbp": 0
    },
    {
        "id": 9,
        "issuer": "Stablemint Ltd",
        "state": "Malta",
        "authority": "MFSA",
        "tokens": "EURsm, USDsm",
        "count": 2,
        "euro": 1,
        "usd": 1,
        "czk": 0,
        "gbp": 0
    },
    {
        "id": 10,
        "issuer": "Ambr Payments UAB",
        "state": "Lithuania",
        "authority": "Bank of Lithuania",
        "tokens": "",
        "count": 0,
        "euro": 0,
        "usd": 0,
        "czk": 0,
        "gbp": 0
    },
    {
        "id": 11,
        "issuer": "UAB Blue EMI LT",
        "state": "Lithuania",
        "authority": "Bank of Lithuania",
        "tokens": "BLUEUR",
        "count": 1,
        "euro": 1,
        "usd": 0,
        "czk": 0,
        "gbp": 0
    },
    {
        "id": 12,
        "issuer": "Stable Europe",
        "state": "Czech Republic",
        "authority": "Czech National Bank",
        "tokens": "CZKI",
        "count": 1,
        "euro": 0,
        "usd": 0,
        "czk": 1,
        "gbp": 0
    },
    {
        "id": 13,
        "issuer": "Fiat Republic Netherlands B.V.",
        "state": "Netherlands",
        "authority": "Dutch National Bank",
        "tokens": "ENEUR, ENGBP",
        "count": 2,
        "euro": 1,
        "usd": 0,
        "czk": 0,
        "gbp": 1
    },
    {
        "id": 14,
        "issuer": "AllUnity GmbH",
        "state": "Germany",
        "authority": "BaFin",
        "tokens": "EURAU",
        "count": 1,
        "euro": 1,
        "usd": 0,
        "czk": 0,
        "gbp": 0
    }
];

    // Non-compliant entities data
    const nonCompliantData = [
        { id: 1, entity: "Dobibo", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://dobibo.com", "https://dobibo1.com", "https://dobibo2.com"] },
        { id: 2, entity: "Fameexn", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://fameexn.top", "https://fameexn.com"] },
        { id: 3, entity: "Spazio Finanziario", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["www.spaziofinanziario.com"] },
        { id: 4, entity: "HTXcoin-az", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://m.htxcoin-az.com"] },
        { id: 5, entity: "Stock Credit Wallet", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://stockcreditwallet.com"] },
        { id: 6, entity: "Paycraftv.top - Paycraftn.top", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://paycraftv.top", "https://paycraftn.top"] },
        { id: 7, entity: "CoinBank Exchange", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://coinbankexchange.icu"] },
        { id: 8, entity: "AKQ", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://akqa715.it", "https://AKQ1181.it"] },
        { id: 9, entity: "Fameexn", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://fameexe.top", "https://fameexj.top"] },
        { id: 10, entity: "ArgonInternational", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://argonintgroup.com", "https://cfd.argonintgroup.com"] },
        { id: 11, entity: "Deroka UAB", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://dtcoin.tech", "https://dtwallet.io", "https://forcedmarketcap.tech"] },
        { id: 12, entity: "DTSocialize Holding PLC", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://dtsmoney.com", "https://portal.dtsmoney.com"] },
        { id: 13, entity: "Caa871", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://caa871.it"] },
        { id: 14, entity: "Sdf837", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://sdf837.it"] },
        { id: 15, entity: "SYBZ", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://sybzgroup.co"] },
        { id: 16, entity: "Egplus.vip", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://egplus.vip"] },
        { id: 17, entity: "Egalite.bond", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://egalite.bond"] },
        { id: 18, entity: "Arbismart UAB", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://arbismart.com", "https://dashboard.arbismart.com"] },
        { id: 19, entity: "Blockbyteq", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://blockbyteq.top"] },
        { id: 20, entity: "Bvoxed", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://bvoxed.com"] },
        { id: 21, entity: "BeratCoin", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://btc6688.com"] },
        { id: 22, entity: "Interersos-Interesosf", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://interersosf.org", "https://interersos.org"] },
        { id: 23, entity: "Cfw896", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://cfw896.it"] },
        { id: 24, entity: "Lumex", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://stratoslumex.com", "https://stratoslumex.net"] },
        { id: 25, entity: "Tmxa", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://60yg.com"] },
        { id: 26, entity: "Uyr968|Fwq367", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://uyr968.it", "https://fwq367.it"] },
        { id: 27, entity: "Syk755", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["www.syk755.it"] },
        { id: 28, entity: "Pxm266", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://pxm266.it"] },
        { id: 29, entity: "Hct685", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://hct685.it"] },
        { id: 30, entity: "Sdh878", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://sdh878.it"] },
        { id: 31, entity: "Skillnexp", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://skillnexp.top"] },
        { id: 32, entity: "Ymg686", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://ymg686.it"] },
        { id: 33, entity: "LWEX", country: "Slovakia", authority: "National Bank of Slovakia (NBS)", websites: ["https://lwex.com/"] },
        { id: 34, entity: "Coingridr.top", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://coingridr.top"] },
        { id: 35, entity: "Gigtaskr", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://gigtaskr.top"] },
        { id: 36, entity: "Sxr922", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://sxr922.it"] },
        { id: 37, entity: "09pqws", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://09pqws.it"] },
        { id: 38, entity: "DSS776", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://dss776.it"] },
        { id: 39, entity: "ERY357", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://ery357.it"] },
        { id: 40, entity: "TNT882", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://tnt882.it"] },
        { id: 41, entity: "ZeroTrillionWorld", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://zerotrillionworld.it"] },
        { id: 42, entity: "ZGV796", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://zgv796.it"] },
        { id: 43, entity: "78DEF", country: "Italy", authority: "Commissione Nazionale per le Societa e la Borsa (CONSOB)", websites: ["https://78def.it"] }
    ];

    let filteredData = [...data];
    let filteredNonCompliantData = [...nonCompliantData];

    // Dynamic calculation functions
    function calculateCurrencyTotals() {
        const currencies = {};

        // Get all currency columns from data (excluding standard fields)
        const standardFields = ['id', 'issuer', 'state', 'authority', 'tokens', 'count'];
        const currencyFields = Object.keys(data[0] || {}).filter(key => !standardFields.includes(key));

        currencyFields.forEach(currency => {
            const total = data.reduce((sum, item) => sum + (item[currency] || 0), 0);
            if (total > 0) {
                currencies[currency.toUpperCase()] = total;
            }
        });

        return currencies;
    }

    function generateKPICards() {
        const container = document.getElementById('kpiContainer');
        const currencies = calculateCurrencyTotals();

        // Base KPI cards
        const baseKPIs = [
            {
                title: 'Total Issuers',
                value: data.length,
                subtitle: 'Active EMT Providers',
                icon: '🏢',
                color: 'kpi-teal'
            },
            {
                title: 'Total Tokens',
                value: data.reduce((sum, item) => sum + item.count, 0),
                subtitle: 'Authorized EMTs',
                icon: '🪙',
                color: 'kpi-blue'
            }
        ];

        // Currency KPI cards
        const currencyKPIs = Object.entries(currencies).map(([currency, count], index) => {
            const info = currencyInfo[currency] || { symbol: '💶', name: currency, color: 'teal' };
            return {
                title: `${currency} Tokens`,
                value: count,
                subtitle: `${info.name}-backed`,
                icon: info.symbol,
                color: kpiColors[(index + 2) % kpiColors.length]
            };
        });

        // Non-compliant KPI
        const nonCompliantKPI = {
            title: 'Non-Compliant',
            value: nonCompliantData.length,
            subtitle: 'Flagged Entities',
            icon: '⚠️',
            color: 'kpi-red'
        };

        const allKPIs = [...baseKPIs, ...currencyKPIs, nonCompliantKPI];

        // Adjust grid columns based on number of KPIs
        const gridCols = Math.min(allKPIs.length, 6);
        container.className = `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-${gridCols} gap-6 mb-8 fade-in`;

        container.innerHTML = allKPIs.map(kpi => `
            <div class="kpi-card ${kpi.color} p-6 rounded-2xl shadow-lg text-white card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm opacity-90 font-medium">${kpi.title}</p>
                        <p class="text-3xl font-bold mt-2">${kpi.value}</p>
                        <p class="text-sm opacity-80 mt-1">${kpi.subtitle}</p>
                    </div>
                    <div class="text-4xl opacity-80">${kpi.icon}</div>
                </div>
            </div>
        `).join('');
    }

    function generateCurrencyDistribution() {
        const container = document.getElementById('currencyDistribution');
        const currencies = calculateCurrencyTotals();
        const totalTokens = Object.values(currencies).reduce((sum, count) => sum + count, 0);

        container.innerHTML = Object.entries(currencies).map(([currency, count]) => {
            const info = currencyInfo[currency] || { symbol: '💶', name: currency };
            const percentage = ((count / totalTokens) * 100).toFixed(1);

            return `
                <div class="text-center p-6 bg-gradient-to-br from-teal-50 to-teal-100 rounded-xl currency-card">
                    <div class="text-4xl mb-3">${info.symbol}</div>
                    <div class="text-2xl font-bold text-teal-600">${count}</div>
                    <div class="text-gray-600">${currency} Tokens</div>
                    <div class="text-sm text-gray-500 mt-2">${percentage}% of total</div>
                </div>
            `;
        }).join('');
    }

    // Calculate aggregated data
    const totalIssuers = data.length;
    const totalTokens = data.reduce((sum, item) => sum + item.count, 0);
    const nonCompliantCount = nonCompliantData.length;

    // Country and authority distributions (sorted by count descending)
    const countryData = Object.entries(data.reduce((acc, item) => {
        acc[item.state] = (acc[item.state] || 0) + 1;
        return acc;
    }, {})).sort((a, b) => b[1] - a[1]);

    const authorityData = Object.entries(data.reduce((acc, item) => {
        acc[item.authority] = (acc[item.authority] || 0) + 1;
        return acc;
    }, {})).sort((a, b) => b[1] - a[1]);

    // === Shrink header on scroll ===
    window.addEventListener('scroll', () => {
      const header = document.querySelector('.header-sticky');
      if (window.scrollY > 20) {
        header.classList.add('shrink');
      } else {
        header.classList.remove('shrink');
      }
    });
    // Initialize dashboard
      function initDashboard() {
          const formatted = new Date(snapshotDate).toLocaleDateString('en-GB');
          document.getElementById('currentDate').textContent = `Data as of ${formatted}`;

        // Generate dynamic components
        generateKPICards();
        generateCurrencyDistribution();

        // Populate charts and tables
        populateCountryChart();
        populateAuthorityChart();
        populateDetailsTable();
        populateNonCompliantTable();
    }

    function populateCountryChart() {
        const container = document.getElementById('countryChart');
        const maxCount = countryData[0][1]; // First item has highest count due to sorting

        container.innerHTML = countryData.map(([country, count]) => `
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                    <span class="text-xl">${countryFlags[country] || '🏳️'}</span>
                    <span class="text-gray-700 font-medium">${country}</span>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="w-32 bg-gray-200 rounded-full h-3">
                        <div class="bg-gradient-to-r from-teal-500 to-blue-600 h-3 rounded-full progress-bar" 
                             style="width: ${(count / maxCount) * 100}%"></div>
                    </div>
                    <span class="text-teal-600 font-bold text-lg">${count}</span>
                </div>
            </div>
        `).join('');
    }

    function populateAuthorityChart() {
        const container = document.getElementById('authorityChart');
        const maxCount = authorityData[0][1]; // First item has highest count due to sorting

        container.innerHTML = authorityData.map(([authority, count]) => `
            <div class="flex items-center justify-between">
                <span class="text-gray-700 font-medium text-sm">${authority}</span>
                <div class="flex items-center space-x-3">
                    <div class="w-32 bg-gray-200 rounded-full h-3">
                        <div class="bg-gradient-to-r from-teal-500 to-blue-600 h-3 rounded-full progress-bar" 
                             style="width: ${(count / maxCount) * 100}%"></div>
                    </div>
                    <span class="text-teal-600 font-bold text-lg">${count}</span>
                </div>
            </div>
        `).join('');
    }

    function populateDetailsTable(dataToShow = filteredData) {
        const tbody = document.getElementById('detailsTable');
        const noResults = document.getElementById('noResults');

        if (dataToShow.length === 0) {
            tbody.innerHTML = '';
            noResults.classList.remove('hidden');
            return;
        }

        noResults.classList.add('hidden');
        tbody.innerHTML = dataToShow.map((item, index) => {
            // Get all currency columns dynamically
            const standardFields = ['id', 'issuer', 'state', 'authority', 'tokens', 'count'];
            const currencyFields = Object.keys(item).filter(key => !standardFields.includes(key));

            const currencyBadges = currencyFields
                .filter(currency => item[currency] > 0)
                .map(currency => {
                    const currencyCode = currency.toUpperCase();
                    const colorClass = currencyCode === 'EUR' ? 'orange' : 
                                     currencyCode === 'USD' ? 'pink' : 
                                     currencyCode === 'GBP' ? 'blue' : 
                                     currencyCode === 'CZK' ? 'purple' : 'green';
                    return `<span class="px-2 py-1 bg-${colorClass}-100 text-${colorClass}-700 rounded text-xs font-semibold">${currencyCode}</span>`;
                }).join(' ');

            return `
                <tr class="border-b hover:bg-gradient-to-r hover:from-teal-50 hover:to-blue-50 transition-all duration-200 ${index % 2 === 0 ? 'bg-gray-50' : 'bg-white'}">
                    <td class="p-4">
                        <div class="font-semibold text-gray-800">${item.issuer}</div>
                    </td>
                    <td class="p-4">
                        <span class="px-3 py-1 bg-teal-100 text-teal-800 rounded-full text-sm font-medium">
                            ${countryFlags[item.state] || '🏳️'} ${item.state}
                        </span>
                    </td>
                    <td class="p-4 text-gray-600 text-sm">${item.authority}</td>
                    <td class="p-4">
                        <div class="text-sm text-gray-800 font-mono">${item.tokens || 'N/A'}</div>
                    </td>
                    <td class="p-4 text-center">
                        <span class="px-3 py-1 rounded-full text-sm font-bold ${
                            item.count > 1 ? 'bg-green-100 text-green-800' : 
                            item.count === 1 ? 'bg-yellow-100 text-yellow-800' : 
                            'bg-gray-100 text-gray-600'
                        }">
                            ${item.count}
                        </span>
                    </td>
                    <td class="p-4 text-center">
                        <div class="flex justify-center space-x-1">
                            ${currencyBadges}
                        </div>
                    </td>
                </tr>
            `;
        }).join('');
    }

    function populateNonCompliantTable(dataToShow = filteredNonCompliantData) {
        const tbody = document.getElementById('nonCompliantTable');
        const noResults = document.getElementById('noNonCompliantResults');

        if (dataToShow.length === 0) {
            tbody.innerHTML = '';
            noResults.classList.remove('hidden');
            return;
        }

        noResults.classList.add('hidden');
        tbody.innerHTML = dataToShow.map((item, index) => `
            <tr class="border-b hover:bg-gradient-to-r hover:from-red-50 hover:to-orange-50 transition-all duration-200 ${index % 2 === 0 ? 'bg-gray-50' : 'bg-white'}">
                <td class="p-4">
                    <div class="font-semibold text-gray-800">${item.entity}</div>
                </td>
                <td class="p-4">
                    <span class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium">
                        ${countryFlags[item.country] || '🏳️'} ${item.country}
                    </span>
                </td>
                <td class="p-4 text-gray-600 text-sm">${item.authority}</td>
                <td class="p-4">
                    <div class="space-y-1">
                        ${item.websites.map(website => `
                            <div class="text-xs text-blue-600 font-mono bg-blue-50 px-2 py-1 rounded">
                                ${website}
                            </div>
                        `).join('')}
                    </div>
                </td>
                <td class="p-4 text-center">
                    <span class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-bold">
                        <i class="fas fa-exclamation-triangle mr-1"></i>Flagged
                    </span>
                </td>
            </tr>
        `).join('');
    }

    // Search functionality
    function filterData(searchTerm) {
        if (!searchTerm.trim()) {
            filteredData = [...data];
        } else {
            const term = searchTerm.toLowerCase();
            filteredData = data.filter(item => 
                item.issuer.toLowerCase().includes(term) ||
                item.state.toLowerCase().includes(term) ||
                item.authority.toLowerCase().includes(term) ||
                item.tokens.toLowerCase().includes(term)
            );
        }
        populateDetailsTable(filteredData);
    }

    function filterNonCompliantData(searchTerm) {
        if (!searchTerm.trim()) {
            filteredNonCompliantData = [...nonCompliantData];
        } else {
            const term = searchTerm.toLowerCase();
            filteredNonCompliantData = nonCompliantData.filter(item => 
                item.entity.toLowerCase().includes(term) ||
                item.country.toLowerCase().includes(term) ||
                item.authority.toLowerCase().includes(term) ||
                item.websites.some(website => website.toLowerCase().includes(term))
            );
        }
        populateNonCompliantTable(filteredNonCompliantData);
    }

    // Tab switching functionality
    function switchTab(tab) {
        const overviewBtn = document.getElementById('overviewBtn');
        const detailsBtn = document.getElementById('detailsBtn');
        const nonCompliantBtn = document.getElementById('nonCompliantBtn');
        const overviewSection = document.getElementById('overviewSection');
        const detailsSection = document.getElementById('detailsSection');
        const nonCompliantSection = document.getElementById('nonCompliantSection');

        // Reset all buttons
        [overviewBtn, detailsBtn, nonCompliantBtn].forEach(btn => {
            btn.className = 'tab-button tab-inactive px-5 py-3 rounded-xl font-semibold';
        });

        // Hide all sections
        [overviewSection, detailsSection, nonCompliantSection].forEach(section => {
            section.classList.add('hidden');
        });

        // Show selected tab
        if (tab === 'overview') {
            overviewBtn.className = 'tab-button tab-active px-5 py-3 rounded-xl font-semibold';
            overviewSection.classList.remove('hidden');
        } else if (tab === 'details') {
            detailsBtn.className = 'tab-button tab-active px-5 py-3 rounded-xl font-semibold';
            detailsSection.classList.remove('hidden');
        } else if (tab === 'nonCompliant') {
            nonCompliantBtn.className = 'tab-button tab-active px-5 py-3 rounded-xl font-semibold';
            nonCompliantSection.classList.remove('hidden');
        }
    }

    // Event listeners
    document.getElementById('overviewBtn').addEventListener('click', () => switchTab('overview'));
    document.getElementById('detailsBtn').addEventListener('click', () => switchTab('details'));
    document.getElementById('nonCompliantBtn').addEventListener('click', () => switchTab('nonCompliant'));

    document.getElementById('searchInput').addEventListener('input', (e) => {
        filterData(e.target.value);
    });

    document.getElementById('clearSearch').addEventListener('click', () => {
        document.getElementById('searchInput').value = '';
        filterData('');
    });

    document.getElementById('nonCompliantSearchInput').addEventListener('input', (e) => {
        filterNonCompliantData(e.target.value);
    });

    document.getElementById('clearNonCompliantSearch').addEventListener('click', () => {
        document.getElementById('nonCompliantSearchInput').value = '';
        filterNonCompliantData('');
    });

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', initDashboard);
    </script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('year').textContent = new Date().getFullYear();
      });
    </script>
</body>
</html>
